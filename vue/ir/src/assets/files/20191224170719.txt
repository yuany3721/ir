计算机学报
绿色数据中心节能设计与建设初探
钟景华，朱利伟，曹播
摘要：PUE和DCiE可以实现对数据中心能效的定量管理。
关键词：绿色数据中心；数据中心定量评价指标；节能设计与建设
一、引言
数据中心已经成为新的电老虎。根据美国环保署报告，2006年美国的数据中心累计消耗610亿度电，占全美当年总耗电量的1.5%，电费约45亿美元，超过美国所有电视机耗电总和，约等于580万个家庭用电量。预计到2011年，美国的数据中心将消耗1000亿度电，占全美总耗电量的2.5%，其电费将达到74亿美元。为满足数据中心耗电需求，美国需要新增10%的发电量。
全球数据中心耗电量同样增长惊人，据IDC报告，2005年全球数据中心的耗电量是全球用电量的0.8%。我国信息化基础设施非常先进，已经与发达国家同步，特别是上网用户已经跃居全球第一。庞大的信息需求引发了海量的数据中心建设，如中国电信、中国网通等大量建设的互联网数据中心IDC，又如金融、税务、电力、企业等各行各业的大量数据中心建设等。
显然，数据中心已经成为用电量增长最快的行业。庞大的数据中心数量和规模，已经让电力工业不堪重负，尤其在节能减排、减少二氧化碳排放的全球协议下，数据中心的节能与降耗已经迫在眉睫，我们需要建设绿色数据中心。
2数据中心能效定量评价指标
为了减少数据中心能量消耗，提高数据中心的能效，全球IT行业的专家们定义了许多数据中心能效模型，其中比较有影响的组织是绿色网格组织。2007年2月，绿色网格组织制定了数据中心的能效比指标，分别叫PUE和DCiE。PUE和DCiE的指标可能会有个阀值，低于这个特定的DCiE阀值，数据中心就被称为是耗能的；高于这个特定的DCiE阀值，数据中心就可被认为是节能的。
2.2指标的发展与分解
DCiE定义了数据中心总能效也就是数据中心生产率（包括IT层和基础设施层），如图5所示。数据中心生产率的表达式为：我们知道：数据中心总能耗=制冷用电负荷+供配电能耗+IT设备能耗所以PUE指标分解为：CLF就代表在单位IT负载上消耗的制冷用电量，而PLF就代表在单位IT负载上供电系统的损耗，1.0则永远不会变，因为这是IT负载和自己的比率。这样，就可通过一些子指标来定量表征数据中心能效模型。
3数据中心节能设计探讨
上述PUE模型推测清楚地列出了数据中心的能量消耗三大部分，即：
（1）IT设备的能量消耗。
（2）供电系统的能量损耗。
2.1定义
能量使用效率PUE：数据中心基础设施效率DCiE：PUE和DCiE二者成倒数关系。
数据中心分成IT设备和基础设施两个部分，两个部分能效的乘积才是整个数据中心的能效，如图1所示。IT设备部分的能效评价指标还在定义之中，而基础设施部分的能效定义即PUE和（3）制冷系统的能量消耗。
接下来对上述三个能量消耗部分进行探讨。
3.1IT设备的能量消耗
数据中心的IT设备包含服务器、存储器、交换机等，其中以服务器数量最多，占绝大多数。这些IT设备用电特性基本类似，本文以服务器为例。
多数数据中心的服务器为机架式服务器，部分高端数据中心采用小型机、大型机等大型服务器设备，如图6所示。
服务器上的电源（POWER）和PC（个人电脑）电源一样，都是一种开关电源。比如联想万全2200C/2400C服务器就采用了EPS标准的电源，该电源输出功率为300W，输入电压宽范围为90~264V，功率因数大于0.95。
业界某知名厂商的一款1U标准服务器电源的铭牌，如图7所示。
服务器电源的铭牌，一般不会直接贴在服务器的外壳上，而是贴在服务器电源外壳比较空旷的地方，通常都只有在从服务器中取出服务器电源后才能看到。
需要特别强调的是INPUT（输入）中“220V”是服务器电源额定输入电压；而“4A”指的是最大输入电流能力，表征的电源最大输入电流能力。因此，服务器电源的输入功率（即消耗功率）不能直接用输入额定电压×输入最大电流来计算。
OUTPUT（输出）中的“250WMAX”这个参数才是该服务器电源最大输出功率，这个参数对于数据中心设计者才具有重要的设计意义，但遗憾的是，通常服务器厂家没有将这个参数标识在服务器外壳上，这个参数通常只有在服务器电源铭牌上才能看到。服务器电源的输出最大功率为250W，按照AC/DC转换效率85%（平均值）计算，那么服务器的输入功率（消耗功率）PSERVER为：
PSERVER=PMAXOUT/η=250W/0.85=294.12W≈295W
其中PMAXOUT等于250W，η为AC/DC效率，取平均值85%。
服务器的输入功率（消耗功率）PSERVER代表服务器的最大工作功率，即在设计满配置（CPU、内存、硬盘等全满配置），CPU、内存和硬盘等设备全负荷100%速度工作时，所能消耗的最大功率，而服务器使用过程中这种工况是非常罕见的。
在数据中心设计中，我们可以参考配置系数c，同时利用系数k。
PACTUAL=PSERVER×c×k=295×0.8×0.8=188.8w
其中配置系数c取0.8，代表服务器电源的厂家裕量。k为同时利用系数，取0.8。上述数据符合实测结果，在某数据中心测量DellPoweredge1U和2U服务器的波形，如图8所示。左图为1U服务器222.5V*0.65A=144.63VA，右图为2U服务器223.8*1.37=306.61VA。以上讨论的是服务器配置一个电源的工作功率，但是为了提高服务器工作可靠性，目前服务器普遍采用冗余电源技术，它具有均流、故障切换等功能，可以有效避免电源故障对系统的影响，实现24×7的不停顿运行。
冗余电源较为常见的是N+1冗余（1+1、2+1、3+1等），可以保证一个电源发生故障的情况下系统不会瘫痪（同时出现两个以上电源故障的概率非常小）。冗余电源通常和热插拔技术配合，即热插拔冗余电源，使得可以在系统运行时拔下出现故障的电源并换上一个完好的电源，从而大大提高了服务器系统的稳定性和可靠性。
因为冗余电源的应用，带来新的问题：每一个服务器电源工作在较轻负荷状态之下，导致工作效率降低，如图9所示。比如1+1电源配置下，每一个服务器电源的负载均小于50%（通常只有20%负载），这样电源模块的效率将只有80%，甚至更低至75%。
为了提高服务器电源的工作效率，减小服务器体积，服务器开始向刀片式服务器升级，如图10所示。
所谓刀片式服务器，就是指服务器外形扁而平，活像个刀片，于是形象的叫做“刀片服务器”。在标准高度的机架式机箱内可插装多个卡式的服务器单元（即刀片，其实际上是符合工业标准的板卡，上有处理器、内存和硬盘等，并安装了操作系统，因此一个刀片就是一台小型服务器），这一张张的刀片组合起来，进行数据的互通和共享，在系统软件的协调下同步工作就可以变成高可用和高密度的新型服务器。
这些刀片服务器共用系统背板、冗余电源、冗余风扇、网络端口、光驱、软驱、键盘、显示器和鼠标，一个机箱对外就是一台服务器，而且多个刀片机箱还可以级联，形成更大的集群系统。
因为一个标准机架式机箱通常内置了8~14个刀片服务器，这些服务器共用冗余电源，所以服务器电源的工作效率得到很大提升。而刀片服务器因为体积小，与同等速度配置的机架式服务器相比，更加省电与节能。表1列出了某款刀片服务器与同等配置机架服务器的功率和发热量对比。
显然，采用刀片式服务器，在休眠状态、最大工况情况下，功率和发热量分别降低33%和28%，取中间值30%。
在一个中等规模的数据中心，通常会有数千台服务器，假定某中型数据中心有2800台服务器（全部折算为1U的标准机架服务器），那么折算的用电功率为：参考配置系数c=0.8，PALLSEVER=PMAX×c×2800=377×0.8×2800=844.48kW。
如果全部采用刀片式服务器，需要200个刀片机框+2800片刀片单元，用电功率为：
PALLBLADE=PMAX×c×2800=270×0.8×2800=604.8kW。
显然，采用刀片式服务器，节约电力239.68kW，假设全年计算时间利用效率为0.7，那么可节省的电费为：
E=（239.68×365×24×0.7）/0.9=2332885.33kWh
Y=E×0.7元/度=163万元
其中0.7为全年同时利用率；0.9为UPS的效率；电费粗略计为0.7元/度。可见采用新型的刀片式服务器，节约的电费是惊人。而因为功率的节省，还会带来机房空调的节电。
宏观上，中国大陆每年的PC服务器总发货量在70万台左右，按照每台服务器400W功耗计算，一年消耗电力24亿度，如果全部采用刀片，可以节约7.3亿度电，相当于少燃烧36万吨标准煤（假定1吨煤可发电2000度电）。
即便我们能把10％的服务器改成刀片也还能节约近4万吨标准煤，这对当前倡导节能减排是非常有意义的。
3.2供电系统的能量损耗
供电系统指的是在市电变压器、发电机组之后，包括ATS自动切换开关、配电系统、UPS、供电电缆等环节。
在计算机类负载为1kW时，为计算机类负载供电的系统（包括ATS自动切换开关、低压配电开关、UPS供电系统、供电电缆等）
在输出功率1kW条件下，供电系统的损耗即为PUE供电因子，计算的数学模型为：
供电因子PowerLoadFactor=ATS开关损耗+低压配电系统损耗+UPS系统损耗+供电电缆损耗
其中ATS开关损耗、低压配电系统损耗、供电电缆损耗很小，基本上是铜损与接触电阻损耗，统计数据表明为1%~3%左右，取中间值2%，即为0.02。
供电因子PowerLoadFactor=0.02+UPS系统损耗。
而在数据中心设计与运营中，UPS系统的损耗随着UPS供电方案不同而变化。根据TIA942标准与新《电子信息机房设计规范》（GB50174-2008），数据中心UPS实际供电方案或为N+1供电系统，或为2N与2（N+1）供电系统，如图11及图12所示。
大中型数据中心中，最常见的供电系统为2N、2（N+1），他们在不同配置方式下负载比率不同，效率略有差异。本文以负载假设某数据中心服务器等计算机类负载为100kW。
如果配置两台UPS组成单机双母线解决方案，UPS容量可按两种方法选择：
（1）经济型，选用160kVa/144kW，输出功率因数为0.9。
（2）扩容型，选用200kVa/180kW，输出功率因数为0.9。
3.2.1经济型方案UPS效率与供电因子计算机类负载为100kW，正常工作时双母线上每台UPS平分负载，即每台UPS承担负载为50kW，单台UPS的负载率为：
K=50/144=34%。
艾默生HipulseU160kVA/144kWUPS效率表，如表2所示。
将负载率34%放入25%~50%区间，进行数学插值法计算，得出损耗率为：
Η=8.77%，即0.0877
则供电系统总损耗为：供电因子PowerLoadFactor=0.02+UPS系统损耗=0.02+0.0877=0.108
3.2.2扩容型方案UPS效率与供电因子扩容型方案中，UPS容量较大，为200kVa/180kW。计算机类负载为100kW，两条母线上每台UPS平分负载，即每台UPS承担负载为50kW，单台UPS的负载率为：
K=50/180=27%
艾默生HipulseU200kVA/180kWUPS效率表，如表3所示。（注，表中数据为电池浮充电状态）
负载率27%约等于25%，得出损耗率为：Η=9.37%，即0.0937。
则供电系统总损耗为：供电因子PowerLoadFactor=0.02+UPS系统损耗=0.02+0.0937=0.114。
上述两种UPS供电方案下，PUE指标中的供电因子PowerLoadFactor，从0.108变化到0.114，变动不大，说明UPS供电系统是对PUE影响较小的因素。有几点需要强调的是：
（1）采用两台UPS主机组成的单机双母线的2N供电系统，是负载率较小的配置，所以所得到PUE供电因子是较大的。
（2）如果采用2（N+1）方式，在配置合理情况下，PUE的供电因子将小于上述计算模型数值。
（3）当配置了带输出隔离变压器的配电柜或者分配柜时，供电回路上每增加一个变压器，供电因子将增加0.03~0.05。
（4）如果为每个UPS输出母线上安装大容量的STS，将导致供电因子增加0.01~0.02。
（5）此计算模型不含市电入户变换器的效率，即功率与损耗计量从低压侧计算，不含35kV/0.4kV或10kV/0.4kV的转换损耗。
5数据中心能效指标PUE的进一步研究工作
上述的模型能够清晰定义数据中心的主要耗电环节，为机房节能设计与运营提供了可行的数学模型。
显然，数据中心节能的重点在于空调部分的能效指标，即PUE空调因子。机房空调的能效指标又与机房的热密度、风道布置、冷热通道、机房建筑热负荷、室外机布置、室内机布置等诸多因素相关，这是本文作者下一步研究工作需要探讨的。此外，有关水制冷系统与直接风冷系统DX的争论，也将具体讨论。
空调提供的制冷剂机外循环也是最新的技术，如果能成功产业化，可将PUE空调因子降低到0.2左右（一年内平均）。
最后，PUE无论怎样变化，都是大于1的乘数因子。要做到最佳节能，降低服务器等IT设备的功耗，才最立竿见影。比如之前的总耗电量为1.6，当服务器设备功耗降低为0.8的时候，数据中心总功耗立即降低为0.8×1.6=1.28。IT设备降低了0.2，而耗电量降低了0.32。这就是乘数因子效应。
参考文献
[1]GreenGrid.《TheGreenGridDataCenterPowerEfficiencyMetrics:PUEandDCiE》
[2]艾默生网络能源白皮书.《能效逻辑》
[3]曹播.《能效逻辑和数据中心定量评价指标》
[4]彭绍华.《现代通信机楼空调系统设计的新思考》